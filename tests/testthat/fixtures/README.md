# Test Fixtures

This directory contains test data for CEDAR unit tests.

## Two Types of Fixtures

### 1. Known Fixtures (`known_test_data.R`)

Hand-crafted test data with **predetermined expected values**. Use these for behavioral tests.

**Characteristics:**
- Version-controlled, never auto-generated
- Small datasets (~10-20 rows per table)
- Comments document exactly what to expect from each filter

**Available fixtures:**
- `known_sections` - 12 course sections
- `known_students` - 24 student enrollments
- `known_programs` - 15 program enrollments
- `known_degrees` - 12 degrees awarded
- `known_faculty` - 8 instructors

**Example usage:**
```r
# Filter by HIST department
filtered <- filter_DESRs(known_sections, opt)

# We KNOW from known_test_data.R that HIST has exactly 4 sections
expect_equal(nrow(filtered), 4)
```

### 2. Schema Fixtures (`cedar_*_test.qs`)

Sampled from real CEDAR data. Use these for **schema validation** (checking columns exist).

**Characteristics:**
- Generated by `create-test-fixtures.R`
- Reflects actual production data schema
- Not for testing specific values

**Available fixtures:**
- `cedar_sections_test.qs`
- `cedar_students_test.qs`
- `cedar_programs_test.qs`
- `cedar_degrees_test.qs`
- `cedar_faculty_test.qs`

## When to Use Which

| Use Case | Fixture Type |
|----------|--------------|
| "Does filter return correct count?" | Known fixtures |
| "Does function return specific courses?" | Known fixtures |
| "Does data have required columns?" | Schema fixtures |
| "Does transformation produce valid output?" | Schema fixtures |

## Regenerating Schema Fixtures

```bash
# After changing transform-to-cedar.R
Rscript R/data-parsers/transform-to-cedar.R
Rscript tests/testthat/create-test-fixtures.R
```

## Editing Known Fixtures

Edit `known_test_data.R` directly. Update the comment headers documenting expected values:

```r
# Expected values for filtering:
#   - By department:
#       HIST: 4 sections
#       MATH: 5 sections
#       ANTH: 3 sections
```

Then update your tests to match.
